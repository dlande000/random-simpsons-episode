<!DOCTYPE html>
<html>
 <head>
  <title>Random Simpsons Episode</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
 </head>
 <body>
  <div>
   <div>
    <h1>Random Simpsons Episode</h1>
    <br />
    <div id="lower_seasons">
    </div>
    <div id="upper_seasons">
    </div>
    <div>
     <button type="button" name="load_episode" id="load_episode" class="btn btn-info">Load episode</button>
    </div>
    <br />
    <div id="episode_table">
    </div>
   </div>
  </div>
 </body>
 </html>

 <script>
$(document).ready(() => {
    let seasonHash = {};
    let episodeHash = {};
    let episodeNum = 1;
    let headers;

  $.ajax({
   url:"simpsons_data.csv",
   dataType:"text",
   success:function(data)
   {
    const episodeData = data.split(/\r?\n|\r/);
        episodeData.forEach((episode, i) => {
            let episodeArr;
            if (i === 0) {
                headers = episode.split(",");
            } else {
                episodeArr = episode.split(",");
                if (!(seasonHash.hasOwnProperty(episodeArr[0]))) {
                    seasonHash[episodeArr[0]] = [episodeNum];
                } else {
                    seasonHash[episodeArr[0]].push(episodeNum);
                }
                let episodeObj = {};
                for (let j = 0; j < headers.length; j++) {
                    if (episodeArr[j].includes("\\comma")) {
                        episodeArr[j] = episodeArr[j].split("\\comma").join(",");
                    }
                    episodeObj[headers[j]] = episodeArr[j];
                }
                episodeHash[episodeNum] = episodeObj;
                episodeNum++;
            }
        });

            let seasonInput = '<select name="seasons">';
            for (let seasonNum = 1; seasonNum < 31; seasonNum++) {
                seasonInput.concat(`<option value=${seasonNum}>${seasonNum}</option>`)
            }
            seasonInput.concat('</select>');

        $('#lower_seasons').html(seasonInput);
        $('#upper_seasons').html(seasonInput);

        $('#load_episode').click(function(){
            let randomInt = (Math.floor(Math.random() * 30)) + 1;
            let randomSeason = seasonHash[randomInt];
            let randomEpNum = randomSeason[Math.floor(Math.random() * randomSeason.length)];
            let randomEp = episodeHash[randomEpNum];
            let episodeHTML = `<div>
                <h2>${randomEp.Title}</h2>
                <h4>Season ${randomEp.Season} Episode ${randomEp.Episode}</h4>
                <img src=${randomEp.Image}></img>
                <p>${randomEp.Description}</p>
                <p>Original airdate: ${randomEp.Airdate}</p>
                <p>
                </div>`
            $('#episode_table').html(episodeHTML);
        });
   }
  }); 
});
 </script>